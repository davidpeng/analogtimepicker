function AnalogTimePicker(t){this.$element_=t,this.$element_.className+=" analogtimepicker-container",this.hour_=0,this.minute_=0,this.largeFontSize_=this.$element_.offsetHeight/6,this.smallFontSize_=this.largeFontSize_/3,this.optionFontSize_=this.$element_.offsetHeight/14,this.tapped_=!1;var e=document.createElement("div");e.className="analogtimepicker-textpart",this.$element_.appendChild(e),this.$hour_=document.createElement("span"),this.$hour_.className="analogtimepicker-textpart-hour analogtimepicker-textpart-selected",this.$hour_.textContent=this.getFormattedHour(),e.appendChild(this.$hour_),this.$hour_.style.width=this.$hour_.offsetWidth+"px";var i=document.createElement("span");i.className="analogtimepicker-textpart-colon",i.textContent=":",e.appendChild(i),this.$minute_=document.createElement("span"),this.$minute_.className="analogtimepicker-textpart-minute",this.$minute_.textContent=this.getFormattedMinute(),e.appendChild(this.$minute_),this.$amPm_=document.createElement("span"),this.$amPm_.className="analogtimepicker-textpart-ampm",this.$amPm_.textContent=this.getFormattedAmPm(),e.appendChild(this.$amPm_);var o=document.createElement("div");o.className="analogtimepicker-clockpart-number",o.textContent=this.formatMinute_(0),this.$element_.appendChild(o);var n=o.offsetWidth,r=o.offsetHeight;this.$element_.removeChild(o),this.$clockPart_=document.createElement("div"),this.$clockPart_.className="analogtimepicker-clockpart",this.$clockPart_.style.paddingBottom=.8*r+"px",this.$element_.appendChild(this.$clockPart_),this.clockCenter_=this.$clockPart_.offsetWidth/2,this.clockRadius_=this.$clockPart_.offsetWidth/2-n;var a=document.createElement("div");for(a.className="analogtimepicker-clockpart-clock",this.$clockPart_.appendChild(a),a.style.height=a.offsetWidth+"px",this.$hourOptions_=[],hour=0;12>hour;hour++)o=document.createElement("div"),o.className="analogtimepicker-clockpart-number",o.textContent=this.formatHour_(hour),this.$clockPart_.appendChild(o),this.positionAtAngle_(o,this.getAngleAtHour_(hour)),this.$hourOptions_.push(o);for(this.$minuteOptions_=[],minute=0;60>minute;minute+=5)o=document.createElement("div"),o.className="analogtimepicker-clockpart-number",o.textContent=this.formatMinute_(minute),this.$clockPart_.appendChild(o),this.positionAtAngle_(o,this.getAngleAtMinute_(minute)),o.style.display="none",this.$minuteOptions_.push(o);this.$am_=document.createElement("div"),this.$am_.className="analogtimepicker-clockpart-ampm",this.$am_.textContent="AM",this.$clockPart_.appendChild(this.$am_),this.$am_.style.left=this.clockCenter_-this.clockRadius_-n/2+"px",this.$am_.style.top=this.clockCenter_+this.clockRadius_+r/2+"px",this.$pm_=document.createElement("div"),this.$pm_.className="analogtimepicker-clockpart-ampm",this.$pm_.textContent="PM",this.$clockPart_.appendChild(this.$pm_),this.$pm_.style.left=this.clockCenter_+this.clockRadius_-this.$pm_.offsetWidth+n/2+"px",this.$pm_.style.top=this.clockCenter_+this.clockRadius_+r/2+"px",this.selectionSize_=Math.max(this.$am_.offsetWidth,this.$am_.offsetHeight),this.$clockSelection_=document.createElement("div"),this.$clockSelection_.className="analogtimepicker-clockpart-selection",this.$clockSelection_.style.width=this.selectionSize_+"px",this.$clockSelection_.style.height=this.selectionSize_+"px",this.$clockPart_.appendChild(this.$clockSelection_),this.positionClockSelection_(),this.$hoverSelection_=document.createElement("div"),this.$hoverSelection_.className="analogtimepicker-clockpart-hoverselection",this.$hoverSelection_.style.width=this.selectionSize_/3+"px",this.$hoverSelection_.style.height=this.selectionSize_/3+"px",this.$hoverSelection_.style.display="none",this.$clockPart_.appendChild(this.$hoverSelection_),this.$amPmSelection_=document.createElement("div"),this.$amPmSelection_.className="analogtimepicker-clockpart-selection",this.$amPmSelection_.style.width=1.2*this.selectionSize_+"px",this.$amPmSelection_.style.height=1.2*this.selectionSize_+"px",this.$clockPart_.appendChild(this.$amPmSelection_),this.$amPmSelection_.style.top=this.$am_.offsetTop-(1.2*this.selectionSize_-this.$am_.offsetHeight)/2+"px",this.positionAmPmSelection_(),this.attachEventHandlers_()}AnalogTimePicker.prototype.formatHour_=function(t){var e=t%12;return 0===e?12:e},AnalogTimePicker.prototype.formatMinute_=function(t){return 1==t.toString().length?"0"+t:t},AnalogTimePicker.prototype.formatAmPm_=function(t){return 12>t?"AM":"PM"},AnalogTimePicker.prototype.positionAtAngle_=function(t,e){t.style.left=this.clockCenter_+this.clockRadius_*Math.cos(e)-t.offsetWidth/2+"px",t.style.top=this.clockCenter_+this.clockRadius_*Math.sin(e)-t.offsetHeight/2+"px"},AnalogTimePicker.prototype.getAngleAtHour_=function(t){return t/12*2*Math.PI-Math.PI/2},AnalogTimePicker.prototype.getAngleAtMinute_=function(t){return t/60*2*Math.PI-Math.PI/2},AnalogTimePicker.prototype.positionClockSelection_=function(){var t="analogtimepicker-textpart-hour  analogtimepicker-textpart-selected"==this.$hour_.className?this.getAngleAtHour_(this.hour_):this.getAngleAtMinute_(this.minute_);this.positionAtAngle_(this.$clockSelection_,t)},AnalogTimePicker.prototype.positionHoverSelection_=function(t){var e="analogtimepicker-textpart-hour analogtimepicker-textpart-selected"==this.$hour_.className?this.getAngleAtHour_(t):this.getAngleAtMinute_(t);this.positionAtAngle_(this.$hoverSelection_,e)},AnalogTimePicker.prototype.positionAmPmSelection_=function(){var t=this.hour_<12?this.$am_:this.$pm_;this.$amPmSelection_.style.left=t.offsetLeft-(1.2*this.selectionSize_-t.offsetWidth)/2+"px"},AnalogTimePicker.prototype.attachEventHandlers_=function(){var t=this;t.$hour_.addEventListener("click",function(){t.switchToChangeHourMode_()}),t.$minute_.addEventListener("click",function(){t.switchToChangeMinuteMode_()}),t.$amPm_.addEventListener("click",function(){var e=(t.hour_+12)%24;t.hour_=e,t.$amPm_.textContent=t.formatAmPm_(t.hour_),t.positionAmPmSelection_(),t.triggerEvent_("timechange")}),t.$element_.addEventListener("mousemove",function(e){var i=t.getClockCoordinates_(e);t.handleMouseMove_(i)}),t.$element_.addEventListener("click",function(e){var i=t.getClockCoordinates_(e);t.handleMouseUp_(i)}),t.$element_.addEventListener("touchstart",function(e){var i=t.getClockCoordinates_(e.touches[0]);if(t.isOverClockOption_(i)){e.preventDefault(),t.tapped_=!0;var o=function(e){document.removeEventListener("touchend",o);var i=t.getClockCoordinates_(e.changedTouches[0]);t.handleMouseUp_(i),t.tapped_=!1};document.addEventListener("touchend",o)}}),t.$element_.addEventListener("touchmove",function(e){t.tapped_=!1;var i=t.getClockCoordinates_(e.touches[0]);t.handleMouseMove_(i)}),t.$am_.addEventListener("click",function(){if(t.hour_>=12){var e=t.hour_-12;t.hour_=e,t.$amPm_.textContent=t.formatAmPm_(t.hour_),t.positionAmPmSelection_(),t.triggerEvent_("timechange")}}),t.$pm_.addEventListener("click",function(){if(t.hour_<12){var e=t.hour_+12;t.hour_=e,t.$amPm_.textContent=t.formatAmPm_(t.hour_),t.positionAmPmSelection_(),t.triggerEvent_("timechange")}})},AnalogTimePicker.prototype.handleMouseMove_=function(t){if(this.isOverClockOption_(t)){var e=this.getAngleAtCoordinates_(t);if("analogtimepicker-textpart-hour analogtimepicker-textpart-selected"==this.$hour_.className){var i=this.getHourAtAngle_(e);this.$hour_.textContent=this.formatHour_(i),this.positionHoverSelection_(i)}else{var o=this.getMinuteAtAngle_(e);this.$minute_.textContent=this.formatMinute_(o),this.positionHoverSelection_(o)}this.$hoverSelection_.style.display="block",this.$element_.style.cursor="pointer"}else"analogtimepicker-textpart-hour analogtimepicker-textpart-selected"==this.$hour_.className?this.$hour_.textContent=this.formatHour_(this.hour_):this.$minute_.textContent=this.formatMinute_(this.minute_),this.$hoverSelection_.style.display="none",this.$element_.style.cursor="auto"},AnalogTimePicker.prototype.handleMouseUp_=function(t){if(this.isOverClockOption_(t)){var e=this.getAngleAtCoordinates_(t);if("analogtimepicker-textpart-hour analogtimepicker-textpart-selected"==this.$hour_.className){var i=12*Math.floor(this.hour_/12)+this.getHourAtAngle_(e);this.hour_!=i&&(this.hour_=i,this.$hour_.textContent=this.formatHour_(this.hour_),this.triggerEvent_("timechange")),this.switchToChangeMinuteMode_()}else{var o=this.getMinuteAtAngle_(e);this.minute_!=o&&(this.minute_=o,this.$minute_.textContent=this.formatMinute_(this.minute_),this.positionClockSelection_(),this.triggerEvent_("timechange"))}this.$hoverSelection_.style.display="none"}},AnalogTimePicker.prototype.getClockCoordinates_=function(t){var e=this.$clockPart_.getBoundingClientRect(),i=e.left+document.body.scrollLeft,o=e.top+document.body.scrollTop;return{x:t.pageX-i-this.clockCenter_,y:t.pageY-o-this.clockCenter_}},AnalogTimePicker.prototype.isOverClockOption_=function(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return Math.abs(e-this.clockRadius_)<this.selectionSize_/2},AnalogTimePicker.prototype.getAngleAtCoordinates_=function(t){return Math.atan2(t.y,t.x)+Math.PI/2},AnalogTimePicker.prototype.getHourAtAngle_=function(t){return(Math.round(6*t/Math.PI)+12)%12},AnalogTimePicker.prototype.getMinuteAtAngle_=function(t){return this.tapped_?(Math.round(6*t/Math.PI)+12)%12*5:(Math.round(30*t/Math.PI)+60)%60},AnalogTimePicker.prototype.switchToChangeHourMode_=function(){if("analogtimepicker-textpart-hour analogtimepicker-textpart-selected"!=this.$hour_.className){this.$minute_.className="analogtimepicker-textpart-hour";var t;for(t=0;t<this.$minuteOptions_.length;t++)this.$minuteOptions_[t].style.display="none";for(t=0;t<this.$hourOptions_.length;t++)this.$hourOptions_[t].style.display="block";this.$hour_.className="analogtimepicker-textpart-hour analogtimepicker-textpart-selected",this.positionClockSelection_(),this.triggerEvent_("modechange")}},AnalogTimePicker.prototype.switchToChangeMinuteMode_=function(){if("analogtimepicker-textpart-minute analogtimepicker-textpart-selected"!=this.$minute_.className){this.$hour_.className="analogtimepicker-textpart-minute";var t;for(t=0;t<this.$hourOptions_.length;t++)this.$hourOptions_[t].style.display="none";for(t=0;t<this.$minuteOptions_.length;t++)this.$minuteOptions_[t].style.display="block";this.$minute_.className="analogtimepicker-textpart-minute analogtimepicker-textpart-selected",this.positionClockSelection_(),this.triggerEvent_("modechange")}},AnalogTimePicker.prototype.triggerEvent_=function(t){var e=document.createEvent("Event");e.initEvent(t,!0,!0),this.$element_.dispatchEvent(e)},AnalogTimePicker.prototype.switchMode=function(t){switch(t){case"hour":this.switchToChangeHourMode_();break;case"minute":this.switchToChangeMinuteMode_()}},AnalogTimePicker.prototype.getMode=function(){return"analogtimepicker-textpart-hour analogtimepicker-textpart-selected"==this.$hour_.className?"hour":"minute"},AnalogTimePicker.prototype.setHour=function(t){t>=0&&24>t&&(this.hour_=t,this.$hour_.textContent=this.formatHour_(this.hour_),this.$amPm_.textContent=this.formatAmPm_(this.hour_),this.positionClockSelection_(),this.positionAmPmSelection_())},AnalogTimePicker.prototype.setMinute=function(t){t>=0&&60>t&&(this.minute_=t,this.$minute_.textContent=this.formatMinute_(this.minute_),this.positionClockSelection_())},AnalogTimePicker.prototype.getHour=function(){return this.hour_},AnalogTimePicker.prototype.getMinute=function(){return this.minute_},AnalogTimePicker.prototype.getFormattedHour=function(){return this.formatHour_(this.hour_)},AnalogTimePicker.prototype.getFormattedMinute=function(){return this.formatMinute_(this.minute_)},AnalogTimePicker.prototype.getFormattedAmPm=function(){return this.formatAmPm_(this.hour_)},function(t){t.fn.analogtimepicker=function(e,i){function o(){var e=t.Event("show.analogtimepicker.popover");$.triggerHandler(e),e.isDefaultPrevented()||(t(".analogtimepicker-popover").not(v.$popover).fadeOut("fast"),v.$popover.fadeIn("fast"),"undefined"==typeof v.picker&&(v.picker=r()),s(),n(),$.triggerHandler("shown.analogtimepicker.popover"),setTimeout(function(){t(document).one("click.analogtimepicker",function(){g(!1)})},0))}function n(){var t,e,i=v.$inputGroup||v.$input,o=i.offset();switch(v.settings.popoverplacement){case"top":t=o.left+(i.outerWidth()-v.$popover.width())/2,e=o.top-v.$popover.outerHeight();break;case"right":t=o.left+i.outerWidth(),e=o.top+(i.outerHeight()-v.$popover.height())/2;break;case"bottom":t=o.left+(i.outerWidth()-v.$popover.width())/2,e=o.top+i.outerHeight();break;case"left":t=o.left-v.$popover.outerWidth(),e=o.top+(i.outerHeight()-v.$popover.height())/2}v.$popover.css("left",t+"px"),v.$popover.css("top",e+"px")}function r(){var e=new AnalogTimePicker(v.$picker[0]);return e.setHour(v.settings.hour),e.setMinute(v.settings.minute),v.$picker.on("timechange",function(){"undefined"!=typeof v.$input&&(a(),v.$input.trigger("change"));var i=t.Event("picked.analogtimepicker.time",{hour:e.getHour(),minute:e.getMinute()});$.triggerHandler(i)}),v.$picker.on("modechange",function(){var i=t.Event("switched.analogtimepicker.mode",{mode:e.getMode()});$.triggerHandler(i)}),e}function a(){v.$input.val(v.picker.getFormattedHour()+":"+v.picker.getFormattedMinute()+" "+v.picker.getFormattedAmPm())}function s(){if("undefined"!=typeof v.$input){var t=0,e=0,i=/^\s*(\d+)\s*(?::\s*(\d+)\s*)?(\S+)?/.exec(v.$input.val());if(null!==i&&(t=parseInt(i[1]),(0>t||t>=12)&&(t=0),"undefined"!=typeof i[2]&&(e=parseInt(i[2]),(0>e||e>=60)&&(e=0)),"undefined"!=typeof i[3]))switch(i[3].toLowerCase()){case"pm":case"p":t+=12}v.picker.setHour(t),v.picker.setMinute(e)}}function c(){return"undefined"!=typeof v.picker?v.picker.getHour():v.settings.hour}function p(t){"undefined"!=typeof v.picker?v.picker.setHour(t):v.settings.hour=t}function h(){return"undefined"!=typeof v.picker?v.picker.getMinute():v.settings.minute}function l(t){"undefined"!=typeof v.picker?v.picker.setMinute(t):v.settings.minute=t}function u(){return"undefined"!=typeof v.picker?v.picker.getMode():"hour"}function m(t){"undefined"!=typeof v.picker&&v.picker.switchMode(t)}function _(){return v.settings.popoverplacement}function d(t){"undefined"!=typeof v.$popover&&(v.$popover.removeClass(v.settings.popoverplacement),v.$popover.addClass(t)),v.settings.popoverplacement=t,n()}function g(e){if("undefined"!=typeof v.$popover&&e!=v.$popover.is(":visible"))if(e)o();else{var i=t.Event("hide.analogtimepicker.popover");$.triggerHandler(i),i.isDefaultPrevented()||(v.$popover.fadeOut("fast"),$.triggerHandler("hidden.analogtimepicker.popover"))}}function f(){"undefined"!=typeof v.$input?(v.$input.off(k),v.$input.off("click.analogtimepicker"),"undefined"!=typeof v.$inputGroup&&v.$inputGroup.find("button").off("click.analogtimepicker"),t(window).off("resize.analogtimepicker"),t(document).off("click.analogtimepicker"),v.$popover.remove()):v.$picker.empty(),$.removeData("analogtimepicker")}var k="change.analogtimepicker keyup.analogtimepicker paste.analogtimepicker input.analogtimepicker",$=t(this),v=$.data("analogtimepicker");if("undefined"==typeof v){if(v={},v.settings=t.extend({},t.fn.analogtimepicker.defaults,e instanceof Object?e:{},$.data()),"input"==$.prop("tagName").toLowerCase())v.$input=$;else{var y=$.find("input");y.length>0&&(v.$inputGroup=$,v.$input=y.first())}if("undefined"!=typeof v.$input){v.$popover=t('<div class="popover analogtimepicker-popover"><div class="arrow"></div></div>'),v.$popover.addClass(v.settings.popoverplacement),v.$popover.click(function(t){t.stopPropagation()});var A=t("<div>");A.addClass("popover-content"),A.addClass("analogtimepicker-popover-content"),v.$picker=t("<div>"),v.$picker.appendTo(A),A.appendTo(v.$popover),v.$popover.appendTo(t("body")),v.$input.on(k,s),v.$input.on("click.analogtimepicker",function(t){t.stopPropagation(),o()}),"undefined"!=typeof v.$inputGroup&&v.$inputGroup.find("button").on("click.analogtimepicker",function(t){t.stopPropagation(),g(!v.$popover.is(":visible"))}),t(window).on("resize.analogtimepicker",n)}else v.$picker=$,v.picker=r();$.data("analogtimepicker",v)}if("string"==typeof e){var P;switch(e){case"hour":"undefined"==typeof i?P=c():p(i);break;case"minute":"undefined"==typeof i?P=h():l(i);break;case"mode":"undefined"==typeof i?P=u():m(i);break;case"popoverplacement":"undefined"==typeof i?P=_():d(i);break;case"showpopover":g(!0);break;case"hidepopover":g(!1);break;case"destroy":f()}return P}return $},t.fn.analogtimepicker.defaults={hour:0,minute:0,popoverplacement:"bottom"},t(function(){t(".analogtimepicker").each(function(){t(this).analogtimepicker()})})}(jQuery);