function AnalogTimePicker(e,t,i){this.$element_=e,this.$element_.addClass("atp"),this.hour_="undefined"!=typeof t?t:0,this.minute_="undefined"!=typeof i?i:0,this.width_=this.$element_.width(),this.height_=this.$element_.height(),this.largeFontSize_=this.height_/6,this.smallFontSize_=this.largeFontSize_/3,this.optionFontSize_=this.height_/14,this.tapped_=!1,this.beforeChangeTimeHandler_=function(){},this.afterChangeTimeHandler_=function(){},this.beforeSwitchModeHandler_=function(){},this.afterSwitchModeHandler_=function(){};var o=$("<div>");o.addClass("atp-time"),o.appendTo(this.$element_),this.$hour_=$("<div>12</div>"),this.$hour_.css("cursor","pointer"),this.$hour_.css("display","inline-block"),this.$hour_.css("font-size",this.largeFontSize_+"px"),this.$hour_.css("text-align","right"),this.$hour_.addClass("atp-selected"),this.$hour_.appendTo(o),this.$hour_.width(this.$hour_.width()),this.$hour_.text(this.getDisplayHour_(this.hour_));var n=$("<span>:</span>");n.css("font-size",this.largeFontSize_+"px"),n.appendTo(o),this.$minute_=$("<span>"),this.$minute_.text(this.getDisplayMinute_(this.minute_)),this.$minute_.css("cursor","pointer"),this.$minute_.css("font-size",this.largeFontSize_+"px"),this.$minute_.appendTo(o),this.$amPm_=$("<span>"),this.$amPm_.text(this.getDisplayAmPm_(this.hour_)),this.$amPm_.css("cursor","pointer"),this.$amPm_.css("font-size",this.smallFontSize_+"px"),this.$amPm_.appendTo(o),this.$hour_.css("margin-left",(o.width()-this.$hour_.width()-n.width()-this.$minute_.width()-this.$amPm_.width())/2+"px");var s=$("<div>00</div>");s.css("font-size",this.optionFontSize_+"px"),s.appendTo(this.$element_);var r=s.width(),h=s.height();s.remove(),this.clockCenterX_=this.width_/2,this.clockCenterY_=this.$hour_.height()+(this.height_-this.$hour_.height()-h)/2,this.clockRadius_=Math.min(this.width_/2-r,(this.height_-this.$hour_.height()-h)/2-h);var a=$("<div>");for(a.addClass("atp-clock"),a.css("left",this.clockCenterX_-this.clockRadius_-.9*r+"px"),a.css("top",this.clockCenterY_-this.clockRadius_-.9*r+"px"),a.width(2*this.clockRadius_+1.8*r),a.height(2*this.clockRadius_+1.8*r),a.appendTo(this.$element_),this.$hourOptions_=[],t=0;12>t;t++)s=$("<div>"),s.text(this.getDisplayHour_(t)),s.css("font-size",this.optionFontSize_+"px"),s.appendTo(this.$element_),this.positionAtAngle_(s,this.getAngleAtHour_(t)),this.$hourOptions_.push(s);for(this.$minuteOptions_=[],i=0;60>i;i+=5)s=$("<div>"),s.text(this.getDisplayMinute_(i)),s.css("font-size",this.optionFontSize_+"px"),s.hide(),s.appendTo(this.$element_),this.positionAtAngle_(s,this.getAngleAtMinute_(i)),this.$minuteOptions_.push(s);this.$am_=$("<div>AM</div>"),this.$am_.css("cursor","pointer"),this.$am_.css("font-size",this.optionFontSize_+"px"),this.$am_.appendTo(this.$element_),this.$am_.css("left",this.clockCenterX_-this.clockRadius_-r/2+"px"),this.$am_.css("top",this.clockCenterY_+this.clockRadius_+h/2+"px"),this.$pm_=$("<div>PM</div>"),this.$pm_.css("cursor","pointer"),this.$pm_.css("font-size",this.optionFontSize_+"px"),this.$pm_.appendTo(this.$element_),this.$pm_.css("left",this.clockCenterX_+this.clockRadius_-this.$pm_.width()+r/2+"px"),this.$pm_.css("top",this.clockCenterY_+this.clockRadius_+h/2+"px"),this.selectionSize_=Math.max(this.$am_.width(),this.$am_.height()),this.$clockSelection_=$("<div>"),this.$clockSelection_.addClass("atp-selection"),this.$clockSelection_.width(this.selectionSize_),this.$clockSelection_.height(this.selectionSize_),this.$clockSelection_.appendTo(this.$element_),this.positionClockSelection_(),this.$hoverSelection_=$("<div>"),this.$hoverSelection_.addClass("atp-selection"),this.$hoverSelection_.width(this.selectionSize_/3),this.$hoverSelection_.height(this.selectionSize_/3),this.$hoverSelection_.hide(),this.$hoverSelection_.appendTo(this.$element_),this.$amPmSelection_=$("<div>"),this.$amPmSelection_.addClass("atp-selection"),this.$amPmSelection_.width(1.2*this.selectionSize_),this.$amPmSelection_.height(1.2*this.selectionSize_),this.$amPmSelection_.appendTo(this.$element_),this.$amPmSelection_.css("top",this.$am_.position().top-(1.2*this.selectionSize_-this.$am_.height())/2+"px"),this.positionAmPmSelection_(),this.attachEventHandlers_()}AnalogTimePicker.prototype.getDisplayHour_=function(e){var t=e%12;return 0===t?12:t},AnalogTimePicker.prototype.getDisplayMinute_=function(e){return 1==e.toString().length?"0"+e:e},AnalogTimePicker.prototype.getDisplayAmPm_=function(e){return 12>e?"AM":"PM"},AnalogTimePicker.prototype.positionAtAngle_=function(e,t){e.css("left",this.clockCenterX_+this.clockRadius_*Math.cos(t)-e.outerWidth()/2),e.css("top",this.clockCenterY_+this.clockRadius_*Math.sin(t)-e.outerHeight()/2)},AnalogTimePicker.prototype.getAngleAtHour_=function(e){return e/12*2*Math.PI-Math.PI/2},AnalogTimePicker.prototype.getAngleAtMinute_=function(e){return e/60*2*Math.PI-Math.PI/2},AnalogTimePicker.prototype.positionClockSelection_=function(){var e=this.$hour_.hasClass("atp-selected")?this.getAngleAtHour_(this.hour_):this.getAngleAtMinute_(this.minute_);this.positionAtAngle_(this.$clockSelection_,e)},AnalogTimePicker.prototype.positionHoverSelection_=function(e){var t=this.$hour_.hasClass("atp-selected")?this.getAngleAtHour_(e):this.getAngleAtMinute_(e);this.positionAtAngle_(this.$hoverSelection_,t)},AnalogTimePicker.prototype.positionAmPmSelection_=function(){var e=this.hour_<12?this.$am_:this.$pm_;this.$amPmSelection_.css("left",e.position().left-(1.2*this.selectionSize_-e.width())/2+"px")},AnalogTimePicker.prototype.attachEventHandlers_=function(){var e=this;e.$hour_.click(function(){e.switchToChangeHourMode_()}),e.$minute_.click(function(){e.switchToChangeMinuteMode_()}),e.$amPm_.click(function(){var t=(e.hour_+12)%24;e.beforeChangeTimeHandler_(t,this.minute_)!==!1&&(e.hour_=t,e.$amPm_.text(e.getDisplayAmPm_(e.hour_)),e.positionAmPmSelection_(),e.afterChangeTimeHandler_())}),e.$element_.mousemove(function(t){var i=e.getClockCoordinates_(t);e.handleMouseMove_(i)}),e.$element_.click(function(t){var i=e.getClockCoordinates_(t);e.handleMouseUp_(i)}),e.$element_.on("touchstart",function(t){var i=e.getClockCoordinates_(t.originalEvent.touches[0]);e.isOverClockOption_(i)&&(t.preventDefault(),e.tapped_=!0,$(document).one("touchend",function(t){var i=e.getClockCoordinates_(t.originalEvent.changedTouches[0]);e.handleMouseUp_(i),e.tapped_=!1}))}),e.$element_.on("touchmove",function(t){e.tapped_=!1;var i=e.getClockCoordinates_(t.originalEvent.touches[0]);e.handleMouseMove_(i)}),e.$am_.click(function(){if(e.hour_>=12){var t=e.hour_-12;e.beforeChangeTimeHandler_(t,this.minute_)!==!1&&(e.hour_=t,e.$amPm_.text(e.getDisplayAmPm_(e.hour_)),e.positionAmPmSelection_(),e.afterChangeTimeHandler_())}}),e.$pm_.click(function(){if(e.hour_<12){var t=e.hour_+12;e.beforeChangeTimeHandler_(t,this.minute_)!==!1&&(e.hour_=t,e.$amPm_.text(e.getDisplayAmPm_(e.hour_)),e.positionAmPmSelection_(),e.afterChangeTimeHandler_())}})},AnalogTimePicker.prototype.handleMouseMove_=function(e){if(this.isOverClockOption_(e)){var t=this.getAngleAtCoordinates_(e);if(this.$hour_.hasClass("atp-selected")){var i=this.getHourAtAngle_(t);this.$hour_.text(this.getDisplayHour_(i)),this.positionHoverSelection_(i)}else{var o=this.getMinuteAtAngle_(t);this.$minute_.text(this.getDisplayMinute_(o)),this.positionHoverSelection_(o)}this.$hoverSelection_.show(),this.$element_.css("cursor","pointer")}else this.$hour_.hasClass("atp-selected")?this.$hour_.text(this.getDisplayHour_(this.hour_)):this.$minute_.text(this.getDisplayMinute_(this.minute_)),this.$hoverSelection_.hide(),this.$element_.css("cursor","auto")},AnalogTimePicker.prototype.handleMouseUp_=function(e){if(this.isOverClockOption_(e)){var t=this.getAngleAtCoordinates_(e);if(this.$hour_.hasClass("atp-selected")){var i=12*Math.floor(this.hour_/12)+this.getHourAtAngle_(t);this.hour_!=i&&this.beforeChangeTimeHandler_(i,this.minute_)!==!1&&(this.hour_=i,this.$hour_.text(this.getDisplayHour_(this.hour_)),this.afterChangeTimeHandler_()),this.switchToChangeMinuteMode_()}else{var o=this.getMinuteAtAngle_(t);this.minute_!=o&&this.beforeChangeTimeHandler_(this.hour_,o)!==!1&&(this.minute_=o,this.$minute_.text(this.getDisplayMinute_(this.minute_)),this.positionClockSelection_(),this.afterChangeTimeHandler_())}this.$hoverSelection_.hide()}},AnalogTimePicker.prototype.getClockCoordinates_=function(e){return{x:e.pageX-this.$element_.offset().left-this.clockCenterX_,y:e.pageY-this.$element_.offset().top-this.clockCenterY_}},AnalogTimePicker.prototype.isOverClockOption_=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y);return Math.abs(t-this.clockRadius_)<this.selectionSize_/2},AnalogTimePicker.prototype.getAngleAtCoordinates_=function(e){return Math.atan2(e.y,e.x)+Math.PI/2},AnalogTimePicker.prototype.getHourAtAngle_=function(e){return(Math.round(6*e/Math.PI)+12)%12},AnalogTimePicker.prototype.getMinuteAtAngle_=function(e){return this.tapped_?(Math.round(6*e/Math.PI)+12)%12*5:(Math.round(30*e/Math.PI)+60)%60},AnalogTimePicker.prototype.switchToChangeHourMode_=function(){if(this.beforeSwitchModeHandler_("hour")!==!1){this.$minute_.removeClass("atp-selected");var e;for(e=0;e<this.$minuteOptions_.length;e++)this.$minuteOptions_[e].hide();for(e=0;e<this.$hourOptions_.length;e++)this.$hourOptions_[e].show();this.$hour_.addClass("atp-selected"),this.positionClockSelection_(),this.afterSwitchModeHandler_()}},AnalogTimePicker.prototype.switchToChangeMinuteMode_=function(){if(this.beforeSwitchModeHandler_("minute")!==!1){this.$hour_.removeClass("atp-selected");var e;for(e=0;e<this.$hourOptions_.length;e++)this.$hourOptions_[e].hide();for(e=0;e<this.$minuteOptions_.length;e++)this.$minuteOptions_[e].show();this.$minute_.addClass("atp-selected"),this.positionClockSelection_(),this.afterSwitchModeHandler_()}},AnalogTimePicker.prototype.switchMode=function(e){switch(e){case"hour":this.switchToChangeHourMode_();break;case"minute":this.switchToChangeMinuteMode_()}},AnalogTimePicker.prototype.getMode=function(){return this.$hour_.hasClass("atp-selected")?"hour":"minute"},AnalogTimePicker.prototype.setHour=function(e){e>=0&&24>e&&(this.hour_=e,this.$hour_.text(this.getDisplayHour_(this.hour_)),this.$amPm_.text(this.getDisplayAmPm_(this.hour_)),this.positionClockSelection_(),this.positionAmPmSelection_())},AnalogTimePicker.prototype.setMinute=function(e){e>=0&&60>e&&(this.minute_=e,this.$minute_.text(this.getDisplayMinute_(this.minute_)),this.positionClockSelection_())},AnalogTimePicker.prototype.getHour=function(){return this.hour_},AnalogTimePicker.prototype.getMinute=function(){return this.minute_},AnalogTimePicker.prototype.beforeChangeTime=function(e){this.beforeChangeTimeHandler_=e},AnalogTimePicker.prototype.afterChangeTime=function(e){this.afterChangeTimeHandler_=e},AnalogTimePicker.prototype.beforeSwitchMode=function(e){this.beforeSwitchModeHandler_=e},AnalogTimePicker.prototype.afterSwitchMode=function(e){this.afterSwitchModeHandler_=e},AnalogTimePicker.prototype.getDisplayHour=function(){return this.getDisplayHour_(this.hour_)},AnalogTimePicker.prototype.getDisplayMinute=function(){return this.getDisplayMinute_(this.minute_)},AnalogTimePicker.prototype.getDisplayAmPm=function(){return this.getDisplayAmPm_(this.hour_)},function(e){e.fn.analogtimepicker=function(t,i){function o(){var t=e.Event("show.analogtimepicker.popover");k.triggerHandler(t),t.isDefaultPrevented()||(e(".atp-popover").hide(),v.$popover.show(),"undefined"==typeof v.picker&&(v.picker=s()),n(),k.triggerHandler("shown.analogtimepicker.popover"),setTimeout(function(){e(document).one("click.analogtimepicker",function(){v.$popover.hide()})},0))}function n(){var e,t,i=v.$inputGroup||v.$input,o=i.offset();switch(v.settings.popoverplacement){case"top":e=o.left+(i.outerWidth()-v.$popover.width())/2,t=o.top-v.$popover.height();break;case"right":e=o.left+i.outerWidth(),t=o.top+(i.outerHeight()-v.$popover.height())/2;break;case"bottom":e=o.left+(i.outerWidth()-v.$popover.width())/2,t=o.top+i.outerHeight();break;case"left":e=o.left-v.$popover.width(),t=o.top+(i.outerHeight()-v.$popover.height())/2}v.$popover.css("left",e+"px"),v.$popover.css("top",t+"px")}function s(){var t=new AnalogTimePicker(v.$picker,v.settings.hour,v.settings.minute);return t.beforeChangeTime(function(t,i){var o=e.Event("pick.analogtimepicker.time",{hour:t,minute:i});return k.triggerHandler(o),!o.isDefaultPrevented()}),t.afterChangeTime(function(){"undefined"!=typeof v.$input&&(r(),v.$input.trigger("change"));var i=e.Event("picked.analogtimepicker.time",{hour:t.getHour(),minute:t.getMinute()});k.triggerHandler(i)}),t.beforeSwitchMode(function(t){var i=e.Event("switch.analogtimepicker.mode",{mode:t});return k.triggerHandler(i),!i.isDefaultPrevented()}),t.afterSwitchMode(function(){var i=e.Event("switched.analogtimepicker.mode",{mode:t.getMode()});k.triggerHandler(i)}),t}function r(){v.$input.val(v.picker.getDisplayHour()+":"+v.picker.getDisplayMinute()+" "+v.picker.getDisplayAmPm())}function h(){if("undefined"!=typeof v.$input){var e=0,t=0,i=/^\s*(\d+)\s*(?::\s*(\d+)\s*)?(\S+)?/.exec(v.$input.val());if(null!==i&&(e=parseInt(i[1]),(0>e||e>=12)&&(e=0),"undefined"!=typeof i[2]&&(t=parseInt(i[2]),(0>t||t>=60)&&(t=0)),"undefined"!=typeof i[3]))switch(i[3].toLowerCase()){case"pm":case"p":e+=12}v.picker.setHour(e),v.picker.setMinute(t)}}function a(){return"undefined"!=typeof v.picker?v.picker.getHour():v.settings.hour}function p(e){"undefined"!=typeof v.picker?v.picker.setHour(e):v.settings.hour=e}function c(){return"undefined"!=typeof v.picker?v.picker.getMinute():v.settings.minute}function u(e){"undefined"!=typeof v.picker?v.picker.setMinute(e):v.settings.minute=e}function l(){return"undefined"!=typeof v.picker?v.picker.getMode():"hour"}function _(e){"undefined"!=typeof v.picker&&v.picker.setSwitchMode(e)}function d(){return v.settings.popoverplacement}function m(e){"undefined"!=typeof v.$popover&&(v.$popover.removeClass(v.settings.popoverplacement),v.$popover.addClass(e)),v.settings.popoverplacement=e,n()}function g(t){if("undefined"!=typeof v.$popover&&t!=v.$popover.is(":visible"))if(t)o();else{var i=e.Event("hide.analogtimepicker.popover");k.triggerHandler(i),i.isDefaultPrevented()||(v.$popover.hide(),k.triggerHandler("hidden.analogtimepicker.popover"))}}function f(){"undefined"!=typeof v.$input?(v.$input.off($),v.$input.off("click.analogtimepicker"),"undefined"!=typeof v.$inputGroup&&v.$inputGroup.find("button").off("click.analogtimepicker"),e(window).off("resize.analogtimepicker"),e(document).off("click.analogtimepicker"),v.$popover.remove()):v.$picker.empty()}var $="change.analogtimepicker keyup.analogtimepicker paste.analogtimepicker input.analogtimepicker",k=e(this),v=k.data("analogtimepicker");if("undefined"==typeof v){if(v={},v.settings=e.extend({},e.fn.analogtimepicker.defaults,t instanceof Object?t:{},k.data()),"input"==k.prop("tagName").toLowerCase())v.$input=k;else{var y=k.find("input");y.length>0&&(v.$inputGroup=k,v.$input=y.first())}if("undefined"!=typeof v.$input){v.$popover=e('<div class="popover atp-popover"><div class="arrow"></div></div>'),v.$popover.addClass(v.settings.popoverplacement),v.$popover.click(function(e){e.stopPropagation()});var A=e("<div>");A.addClass("popover-content"),A.addClass("atp-popover-content"),v.$picker=e("<div>"),v.$picker.appendTo(A),A.appendTo(v.$popover),v.$popover.appendTo(e("body")),v.$input.on($,h),v.$input.on("click.analogtimepicker",function(e){e.stopPropagation(),o()}),"undefined"!=typeof v.$inputGroup&&v.$inputGroup.find("button").on("click.analogtimepicker",function(e){e.stopPropagation(),g(!v.$popover.is(":visible"))}),e(window).on("resize.analogtimepicker",n)}else v.$picker=k,v.picker=s();k.data("analogtimepicker",v)}if(t instanceof String){var C;switch(t){case"hour":"undefined"==typeof i?C=a():p(i);break;case"minute":"undefined"==typeof i?C=c():u(i);break;case"mode":"undefined"==typeof i?C=l():_(i);break;case"popoverplacement":"undefined"==typeof i?C=d():m(i);break;case"showpopover":g(!0);break;case"hidepopover":g(!1);break;case"destroy":f()}return C}return k},e.fn.analogtimepicker.defaults={hour:0,minute:0,popoverplacement:"bottom"},e(function(){e(".analogtimepicker").each(function(){e(this).analogtimepicker()})})}(jQuery);