function AnalogTimePicker(e){this.hour_=0,this.minute_=0,this.mode_="hour",this.listeners_={},this.tapped_=!1,"INPUT"==e.tagName?(this.popup_=document.createElement("div"),this.popup_.className="analogtimepicker-popup",document.body.appendChild(this.popup_),this.container_=document.createElement("div"),this.popup_.appendChild(this.container_),this.setupContainer_(),this.popup_.style.display="none",this.input_=e,this.syncWithInput_()):(this.container_=e,this.setupContainer_()),this.addEventListeners_(),this.tapped_=!1}AnalogTimePicker.SEPARATOR=":",AnalogTimePicker.AM="AM",AnalogTimePicker.PM="PM",AnalogTimePicker.prototype.setupContainer_=function(){this.container_.className+=" analogtimepicker-container";var e=document.createElement("div");e.className="analogtimepicker-text",this.container_.appendChild(e),this.hourElement_=document.createElement("span"),this.hourElement_.className="analogtimepicker-hour",this.hourElement_.textContent=this.getFormattedHour_(0),e.appendChild(this.hourElement_),this.hourElement_.style.width=this.hourElement_.offsetWidth+"px";var t=document.createElement("span");t.className="analogtimepicker-separator",t.textContent=AnalogTimePicker.SEPARATOR,e.appendChild(t),this.minuteElement_=document.createElement("span"),this.minuteElement_.className="analogtimepicker-minute",this.minuteElement_.textContent=this.getFormattedMinute_(0),e.appendChild(this.minuteElement_),this.period_=document.createElement("span"),this.period_.className="analogtimepicker-period",this.period_.textContent=this.getFormattedPeriod_(0),e.appendChild(this.period_),this.clock_=document.createElement("div"),this.clock_.className="analogtimepicker-clock",this.container_.appendChild(this.clock_);var i=document.createElement("div");i.className="analogtimepicker-number",i.textContent=this.getFormattedMinute_(0),this.container_.appendChild(i),this.numberWidth_=i.offsetWidth,this.clockCenter_=this.clock_.offsetWidth/2,this.numberRadius_=this.clock_.offsetWidth/2-this.numberWidth_,this.container_.removeChild(i);var n=document.createElement("div");n.className="analogtimepicker-face",this.clock_.appendChild(n),n.style.height=n.offsetWidth+"px",this.marker_=document.createElement("div"),this.marker_.className="analogtimepicker-marker",this.clock_.appendChild(this.marker_),this.positionClockElement_(this.marker_,"hour",this.hour_),this.hours_=[];for(var o=0;12>o;o++)i=document.createElement("div"),i.className="analogtimepicker-number",i.textContent=this.getFormattedHour_(o),this.clock_.appendChild(i),this.positionClockElement_(i,"hour",o),this.hours_.push(i);this.minutes_=[];for(var s=0;60>s;s+=5)i=document.createElement("div"),i.className="analogtimepicker-number",i.textContent=this.getFormattedMinute_(s),this.clock_.appendChild(i),this.positionClockElement_(i,"minute",s),this.minutes_.push(i);this.am_=document.createElement("div"),this.am_.className="analogtimepicker-am",this.clock_.appendChild(this.am_);var r=document.createElement("span");r.className="analogtimepicker-periodtext",r.textContent=AnalogTimePicker.AM,this.am_.appendChild(r),r.style.height=r.offsetWidth+"px",this.pm_=document.createElement("div"),this.pm_.className="analogtimepicker-pm",this.clock_.appendChild(this.pm_);var h=document.createElement("span");h.className="analogtimepicker-periodtext",h.textContent=AnalogTimePicker.PM,this.pm_.appendChild(h),h.style.height=h.offsetWidth+"px",this.hover_=document.createElement("div"),this.hover_.className="analogtimepicker-hover",this.hover_.style.visibility="hidden",this.clock_.appendChild(this.hover_),this.refresh_()},AnalogTimePicker.prototype.refresh_=function(){this.hourElement_.textContent=this.getFormattedHour_(this.hour_),this.hourElement_.className="analogtimepicker-hour","hour"==this.mode_&&(this.hourElement_.className+=" analogtimepicker-active",this.positionClockElement_(this.marker_,"hour",this.hour_)),this.minuteElement_.textContent=this.getFormattedMinute_(this.minute_),this.minuteElement_.className="analogtimepicker-minute","minute"==this.mode_&&(this.minuteElement_.className+=" analogtimepicker-active",this.positionClockElement_(this.marker_,"minute",this.minute_)),this.period_.textContent=this.getFormattedPeriod_(this.hour_);for(var e=0;e<this.hours_.length;e++){var t=this.hours_[e];t.style.visibility="hour"==this.mode_?"visible":"hidden"}for(e=0;e<this.minutes_.length;e++){var i=this.minutes_[e];i.style.visibility="minute"==this.mode_?"visible":"hidden"}this.am_.className="analogtimepicker-am",this.hour_<12&&(this.am_.className+=" analogtimepicker-active"),this.pm_.className="analogtimepicker-pm",this.hour_>=12&&(this.pm_.className+=" analogtimepicker-active")},AnalogTimePicker.prototype.getFormattedHour_=function(e){var t=e%12;return 0===t?12:t},AnalogTimePicker.prototype.getFormattedMinute_=function(e){return 1==e.toString().length?"0"+e:e},AnalogTimePicker.prototype.getFormattedPeriod_=function(e){return 12>e?AnalogTimePicker.AM:AnalogTimePicker.PM},AnalogTimePicker.prototype.positionClockElement_=function(e,t,i){var n=i/("hour"==t?6:30)*Math.PI-Math.PI/2,o=this.numberRadius_*Math.cos(n),s=this.numberRadius_*Math.sin(n);e.style.left=this.clockCenter_+o-e.offsetWidth/2+"px",e.style.top=this.clockCenter_+s-e.offsetHeight/2+"px"},AnalogTimePicker.prototype.addEventListeners_=function(){var e=this;if(e.hourElement_.addEventListener("click",function(){e.setMode("hour",!0)}),e.minuteElement_.addEventListener("click",function(){e.setMode("minute",!0)}),e.period_.addEventListener("click",function(){e.setHour((e.hour_+12)%24,!0)}),e.clock_.addEventListener("mousemove",function(t){e.handleMouseMove_(e.getClockPosition_(t))}),e.clock_.addEventListener("click",function(t){e.handleMouseUp_(e.getClockPosition_(t))}),e.clock_.addEventListener("mouseleave",function(){e.hover_.style.visibility="hidden"}),e.clock_.addEventListener("touchstart",function(t){var i=e.getClockPosition_(t.touches[0]);if(e.mouseIsOverNumber_(i)){t.preventDefault(),e.tapped_=!0;var n=function(t){document.removeEventListener("touchend",n);var i=e.getClockPosition_(t.changedTouches[0]);e.handleMouseUp_(i),e.tapped_=!1};document.addEventListener("touchend",n)}}),e.clock_.addEventListener("touchmove",function(t){e.tapped_=!1,e.handleMouseMove_(e.getClockPosition_(t.touches[0]))}),e.am_.addEventListener("click",function(){e.setHour(e.hour_-12,!0)}),e.pm_.addEventListener("click",function(){e.setHour(e.hour_+12,!0)}),e.input_){for(var t=["change","keyup","paste","input"],i=function(){e.syncWithInput_()},n=0;n<t.length;n++)e.input_.addEventListener(t[n],i);e.input_.addEventListener("click",function(){e.showPopup(!0)})}},AnalogTimePicker.prototype.getClockPosition_=function(e){var t=this.getPagePosition_(this.clock_),i=e.pageX-t.x-this.clockCenter_,n=e.pageY-t.y-this.clockCenter_;return{radius:Math.sqrt(i*i+n*n),angle:Math.atan2(n,i)+Math.PI/2}},AnalogTimePicker.prototype.getPagePosition_=function(e){var t=document.documentElement.scrollLeft||document.body.scrollLeft,i=document.documentElement.scrollTop||document.body.scrollTop,n=e.getBoundingClientRect();return{x:t+n.left,y:i+n.top}},AnalogTimePicker.prototype.handleMouseMove_=function(e){if(this.mouseIsOverNumber_(e)){var t=this.getAngleValue_(e.angle);"hour"==this.mode_?(this.hourElement_.textContent=this.getFormattedHour_(t),this.positionClockElement_(this.hover_,"hour",t)):(this.minuteElement_.textContent=this.getFormattedMinute_(t),this.positionClockElement_(this.hover_,"minute",t)),this.hover_.style.visibility="visible",this.clock_.style.cursor="pointer"}else this.refresh_(),this.hover_.style.visibility="hidden",this.clock_.style.cursor="auto"},AnalogTimePicker.prototype.handleMouseUp_=function(e){if(this.mouseIsOverNumber_(e)){var t=this.getAngleValue_(e.angle);"hour"==this.mode_?(this.setHour(12*Math.floor(this.hour_/12)+t,!0),this.setMode("minute",!0)):this.setMinute(t,!0),this.hover_.style.visibility="hidden"}},AnalogTimePicker.prototype.mouseIsOverNumber_=function(e){return Math.abs(e.radius-this.numberRadius_)<this.numberWidth_},AnalogTimePicker.prototype.getAngleValue_=function(e){return"hour"==this.mode_?(Math.round(6*e/Math.PI)+12)%12:this.tapped_?(Math.round(6*e/Math.PI)+12)%12*5:(Math.round(30*e/Math.PI)+60)%60},AnalogTimePicker.prototype.showPopup=function(e){var t=this.getPagePosition_(this.input_);this.popup_.style.left=t.x+"px",this.popup_.style.top=t.y+this.input_.offsetHeight+"px",this.popup_.style.display="block";var i=function(e){this.container_.contains(e.target)||(document.body.removeEventListener("click",i),this.hidePopup(!0))}.bind(this);document.body.addEventListener("click",i,!0),e&&this.triggerEvent_("popupshow")},AnalogTimePicker.prototype.hidePopup=function(e){this.popup_.style.display="none",e&&this.triggerEvent_("popuphide")},AnalogTimePicker.prototype.syncWithInput_=function(){var e=new RegExp("^\\s*(0?[0-9]|1[0-2])\\"+AnalogTimePicker.SEPARATOR+"([0-5][0-9])\\s*("+AnalogTimePicker.AM+"|"+AnalogTimePicker.PM+")\\s*$","i"),t=e.exec(this.input_.value);if(t){var i=parseInt(t[1]),n=parseInt(t[2]);t[3].toLowerCase()==AnalogTimePicker.PM.toLowerCase()&&(i+=12),(i!=this.hour_||n!=this.minute_)&&(this.setHour(i,!1,!0),this.setMinute(n,!1,!0),this.triggerEvent_("timechange"))}},AnalogTimePicker.prototype.setMode=function(e,t){this.mode_==e||"hour"!=e&&"minute"!=e||(this.mode_=e,this.refresh_(),t&&this.triggerEvent_("modechange"))},AnalogTimePicker.prototype.getMode=function(){return this.mode_},AnalogTimePicker.prototype.setHour=function(e,t,i){this.hour_!=e&&e>=0&&24>e&&(this.hour_=e,this.refresh_(),!i&&this.input_&&this.updateInput_(),t&&this.triggerEvent_("timechange"))},AnalogTimePicker.prototype.getHour=function(){return this.hour_},AnalogTimePicker.prototype.setMinute=function(e,t,i){this.minute_!=e&&e>=0&&60>e&&(this.minute_=e,this.refresh_(),!i&&this.input_&&this.updateInput_(),t&&this.triggerEvent_("timechange"))},AnalogTimePicker.prototype.getMinute=function(){return this.minute_},AnalogTimePicker.prototype.triggerEvent_=function(e){if(this.listeners_[e])for(var t=0;t<this.listeners_[e].length;t++)this.listeners_[e][t].call(this)},AnalogTimePicker.prototype.updateInput_=function(){var e=this.getFormattedHour_(this.hour_),t=this.getFormattedMinute_(this.minute_),i=this.getFormattedPeriod_(this.hour_);this.input_.value=e+AnalogTimePicker.SEPARATOR+t+" "+i},AnalogTimePicker.prototype.addEventListener=function(e,t){this.listeners_[e]||(this.listeners_[e]=[]),this.listeners_[e].push(t)},AnalogTimePicker.prototype.removeEventListener=function(e,t){if(this.listeners_[e]){var i=this.listeners_[e].indexOf(t);-1!=i&&this.listeners_[e].splice(i,1)}};